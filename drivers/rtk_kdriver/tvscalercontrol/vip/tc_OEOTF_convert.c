/*==========================================================================
  * Copyright (c)      Realtek Semiconductor Corporation, 2014
  * All rights reserved.
  * ========================================================================*/
  /*================= File Description =======================================*/
  /**
   * @file
   *  This file is for HDR TC related functions.
   *
   * @author  $Author$
   * @date	  $Date$
   * @version	  $Revision$
   */


  /*============================ Module dependency	===========================*/
#if CONFIG_FIRMWARE_IN_KERNEL
#include <linux/string.h>
#include <tvscalercontrol/io/ioregdrv.h>
#include <linux/kernel.h>
//juwen, 0303
//#include "tvscalercontrol/vip/tc_hdr.h"
//#include <tvscalercontrol/vip/tc_hdr.h>
#include <tvscalercontrol/scaler/vipinclude.h> // for typedef that used in VIP_reg_def.h
#include <tvscalercontrol/vip/vip_reg_def.h>
//#include <rbus/rbusTCReg.h>
#include <rbus/tc_reg.h>

#else
#include <unistd.h>		// 'close()'
#include <fcntl.h>			// 'open()'
#include <stdio.h>
#include <sys/ioctl.h>

#include <Platform_Lib/TVScalerControl/io/ioRegDrv.h>
#include <Platform_Lib/TVScalerControl/vip/tc_hdr.h>
#include <Platform_Lib/TVScalerControl/vip/VIP_reg_def.h>


#endif

#if CONFIG_FIRMWARE_IN_KERNEL
#define VIPprintf(fmt, args...)	pr_debug(fmt, ##args)//printk(KERN_DEBUG fmt, ##args)
#else
#define VIPprintf(fmt, args...)	printf(fmt, ##args)
#endif

int GammatoOETF[65] =
{
      0,  2668,  5159,  7495,  9695, 11774, 13743, 15615,
  17399, 19101, 20730, 22292, 23791, 25233, 26622, 27961,
  29254, 30505, 31715, 32887, 34025, 35128, 36201, 37243,
  38258, 39246, 40209, 41148, 42063, 42958, 43831, 44685,
  45519, 46336, 47135, 47918, 48685, 49436, 50173, 50896,
  51605, 52300, 52984, 53655, 54314, 54962, 55599, 56226,
  56842, 57448, 58045, 58632, 59211, 59780, 60341, 60894,
  61439, 61976, 62506, 63028, 63543, 64051, 64553, 65048,
  65536
};

/******************************************************************************
 * EOTF to Sqrt
 ******************************************************************************/

unsigned short EOTFtoSqrt_alpha[200] =
{
         0,      4096,      1201,      2055,      2715,      3253,      3705,      4096,
       868,      1643,      2343,      2976,      3559,      4096,       796,      1541,
      2239,      2893,      3511,      4096,       293,       573,       839,      1094,
      1336,      1570,      1793,      2009,      2217,      2417,      2610,      2797,
      2977,      3152,      3320,      3486,      3644,      3800,      3951,      4096,
       150,       296,       438,       575,       711,       843,       971,      1098,
      1221,      1341,      1459,      1574,      1687,      1799,      1906,      2013,
      2117,      2221,      2321,      2421,      2518,      2614,      2707,      2799,
      2890,      2980,      3067,      3153,      3238,      3322,      3404,      3486,
      3566,      3646,      3723,      3800,      3875,      3950,      4024,      4096,
        57,       114,       170,       226,       280,       334,       386,       440,
       491,       543,       594,       644,       694,       743,       791,       839,
       886,       933,       979,      1024,      1069,      1115,      1159,      1204,
      1247,      1290,      1332,      1374,      1416,      1456,      1499,      1539,
      1578,      1619,      1657,      1697,      1736,      1774,      1811,      1849,
      1886,      1924,      1960,      1996,      2032,      2068,      2103,      2138,
      2173,      2208,      2242,      2276,      2309,      2343,      2376,      2409,
      2441,      2474,      2506,      2538,      2569,      2601,      2631,      2662,
      2693,      2723,      2753,      2783,      2812,      2842,      2871,      2901,
      2929,      2958,      2986,      3015,      3044,      3071,      3099,      3126,
      3154,      3180,      3208,      3234,      3262,      3287,      3314,      3340,
      3366,      3391,      3418,      3443,      3468,      3493,      3518,      3543,
      3568,      3591,      3616,      3641,      3665,      3688,      3712,      3736,
      3760,      3782,      3806,      3830,      3852,      3875,      3898,      3920,
      3943,      3965,      3987,      4009,      4031,      4053,      4074,      4096
};

static unsigned short EOTFtoSqrt_quadrint(unsigned short EOETF_base[64], unsigned short EOETF_slope[64], unsigned char EOETF_bend[64], unsigned char EOETF_shl[64], unsigned short Ei)
{
  unsigned char  addr;
  unsigned short delta;
  unsigned int Lr;
  unsigned short Li;

  addr  = Ei >> 10;
  delta = Ei  & 0x03ff;

  Lr = (((unsigned short)EOETF_base[(int)addr]) << 2) +
    ((((unsigned int)delta) * ( (((short)EOETF_slope[(int)addr]) << 1) -
    (( ( ((unsigned int)1023) - ((unsigned int)delta) ) * EOETF_bend[(int)addr]) >> 9) )) >> 9);

  Li = (unsigned short)((Lr > 0) ? ((Lr << ((unsigned char)(EOETF_shl [(int)addr]) << 1)) + 2) >> 2 : 0);

  return Li ;
}

/* EOTF and Sqrt: L_HDR = 50 nit */
unsigned int EOTFtoSqrt_quadrint_50(unsigned int x_in)
{
  static unsigned short EOETF_50_base[64] =
  {
           0,       164,       381,       629,       901,      1195,      1509,      1842,
        2194,      2564,      2952,      3359,      3784,      4228,      4691,      5172,
        5673,      6194,      6735,      7296,      7878,      8482,      9107,      9755,
       10426,     11121,     11839,     12582,     13351,     14146,     14967,     15816,
        4173,      4400,      4634,      4875,      5125,      5382,      5648,      5922,
        6205,      6497,      6799,      7109,      7430,      7760,      8101,      8453,
        8815,      9189,      9574,      9972,     10381,     10803,     11238,     11686,
       12148,     12624,     13114,     13619,     14140,     14676,     15229,     15798
  };

  static unsigned short EOETF_50_slope[64] =
  {
         164,       218,       248,       272,       294,       314,       333,       352,
         370,       389,       407,       425,       444,       463,       482,       501,
         521,       541,       561,       582,       604,       625,       648,       671,
         694,       719,       743,       769,       795,       821,       849,       877,
         227,       234,       242,       249,       257,       266,       274,       283,
         292,       301,       311,       321,       331,       341,       352,       362,
         374,       385,       397,       409,       422,       435,       448,       462,
         476,       490,       505,       521,       536,       552,       569,       586
  };

  static unsigned char EOETF_50_bend[64] =
  {
          44,        18,        13,        11,        10,        10,         9,         9,
           9,         9,         9,         9,         9,         9,        10,        10,
          10,        10,        10,        11,        11,        11,        11,        12,
          12,        12,        13,        13,        13,        14,        14,        14,
           4,         4,         4,         4,         4,         4,         4,         4,
           5,         5,         5,         5,         5,         5,         5,         6,
           6,         6,         6,         6,         6,         7,         7,         7,
           7,         7,         8,         8,         8,         8,         8,         9
  };

  static unsigned char EOETF_50_shl[64] =
  {
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           1,         1,         1,         1,         1,         1,         1,         1,
           1,         1,         1,         1,         1,         1,         1,         1,
           1,         1,         1,         1,         1,         1,         1,         1,
           1,         1,         1,         1,         1,         1,         1,         1
  };

  return EOTFtoSqrt_quadrint(EOETF_50_base, EOETF_50_slope, EOETF_50_bend, EOETF_50_shl, (unsigned short)(x_in));
}

/* EOTF and Sqrt: L_HDR = 100 nit */
unsigned int EOTFtoSqrt_quadrint_100(unsigned int x_in)
{
  static unsigned short EOETF_100_base[64] =
  {
           0,       138,       321,       531,       763,      1014,      1283,      1570,
        1875,      2196,      2535,      2891,      3265,      3656,      4066,      4495,
        4942,      5409,      5896,      6403,      6932,      7482,      8054,      8650,
        9268,      9912,     10580,     11274,     11995,     12743,     13519,     14325,
       15161,     16028,      4232,      4465,      4706,      4957,      5216,      5485,
        5764,      6053,      6352,      6662,      6983,      7315,      7659,      8015,
        8384,      8766,      9161,      9570,      9994,     10432,     10886,     11355,
       11841,     12344,     12864,     13402,     13959,     14534,     15130,     15747
  };
  static unsigned short EOETF_100_slope[64] =
  {
         138,       184,       210,       232,       251,       269,       287,       304,
         321,       339,       356,       374,       392,       410,       428,       447,
         467,       487,       507,       528,       550,       572,       595,       619,
         643,       668,       694,       721,       748,       776,       806,       836,
         867,       899,       233,       242,       250,       260,       269,       279,
         289,       299,       310,       321,       332,       344,       356,       369,
         382,       395,       409,       424,       438,       454,       469,       486,
         503,       520,       538,       557,       576,       596,       616,       637
  };
  static unsigned char EOETF_100_bend[64] =
  {
          38,        15,        12,        10,         9,         9,         9,         9,
           9,         9,         9,         9,         9,         9,         9,        10,
          10,        10,        10,        11,        11,        11,        12,        12,
          12,        13,        13,        14,        14,        14,        15,        15,
          16,        16,         4,         4,         4,         5,         5,         5,
           5,         5,         5,         6,         6,         6,         6,         6,
           7,         7,         7,         7,         8,         8,         8,         8,
           9,         9,         9,         9,        10,        10,        10,        11
  };
  static unsigned char EOETF_100_shl[64] =
  {
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         1,         1,         1,         1,         1,         1,
           1,         1,         1,         1,         1,         1,         1,         1,
           1,         1,         1,         1,         1,         1,         1,         1,
           1,         1,         1,         1,         1,         1,         1,         1
  };

  return EOTFtoSqrt_quadrint(EOETF_100_base, EOETF_100_slope, EOETF_100_bend, EOETF_100_shl, (unsigned short)(x_in));
}

/* EOTF and Sqrt: L_HDR = 400 nit */
unsigned int EOTFtoSqrt_quadrint_400(unsigned int x_in)
{
  static unsigned short EOETF_400_base[64] =
  {
           0,        93,       219,       364,       526,       702,       893,      1098,
        1318,      1552,      1800,      2064,      2343,      2637,      2949,      3277,
        3623,      3987,      4369,      4772,      5195,      5639,      6104,      6593,
        7106,      7644,      8207,      8797,      9416,     10063,     10741,     11451,
       12194,     12971,     13784,     14635,     15524,      4114,      4357,      4611,
        4877,      5155,      5445,      5748,      6065,      6397,      6743,      7104,
        7482,      7876,      8288,      8719,      9168,      9637,     10127,     10639,
       11173,     11731,     12313,     12921,     13555,     14218,     14909,     15631
  };
  static unsigned short EOETF_400_slope[64] =
  {
          93,       126,       145,       161,       176,       191,       205,       219,
         234,       249,       264,       279,       295,       311,       328,       346,
         364,       383,       402,       423,       444,       466,       489,       513,
         538,       563,       590,       618,       648,       678,       710,       743,
         777,       813,       851,       890,       930,       243,       254,       266,
         278,       290,       303,       317,       331,       346,       362,       378,
         394,       412,       430,       449,       469,       490,       512,       534,
         558,       582,       608,       635,       662,       691,       722,       753
  };
  static unsigned char EOETF_400_bend[64] =
  {
          26,        11,         9,         8,         7,         7,         7,         7,
           7,         7,         8,         8,         8,         8,         9,         9,
           9,        10,        10,        10,        11,        11,        12,        12,
          13,        13,        14,        14,        15,        16,        16,        17,
          18,        18,        19,        20,        21,         5,         6,         6,
           6,         6,         7,         7,         7,         8,         8,         8,
           9,         9,         9,        10,        10,        11,        11,        12,
          12,        13,        13,        14,        14,        15,        15,        16
  };
  static unsigned char EOETF_400_shl[64] =
  {
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         1,         1,         1,
           1,         1,         1,         1,         1,         1,         1,         1,
           1,         1,         1,         1,         1,         1,         1,         1,
           1,         1,         1,         1,         1,         1,         1,         1
  };

  return EOTFtoSqrt_quadrint(EOETF_400_base, EOETF_400_slope, EOETF_400_bend, EOETF_400_shl, (unsigned short)(x_in));
}

/* EOTF and Sqrt: L_HDR = 700 nit */
unsigned int EOTFtoSqrt_quadrint_700(unsigned int x_in)
{
  static unsigned short EOETF_700_base[64] =
  {
           0,        79,       185,       309,       446,       597,       761,       938,
        1128,      1331,      1548,      1779,      2024,      2284,      2559,      2850,
        3158,      3484,      3828,      4190,      4573,      4976,      5400,      5847,
        6318,      6813,      7334,      7882,      8459,      9064,      9701,     10369,
       11072,     11810,     12585,     13398,     14252,     15149,     16090,      4269,
        4528,      4800,      5085,      5384,      5698,      6027,      6372,      6734,
        7113,      7511,      7928,      8365,      8824,      9304,      9808,     10335,
       10889,     11468,     12076,     12713,     13380,     14079,     14812,     15580
  };
  static unsigned short EOETF_700_slope[64] =
  {
          79,       107,       123,       138,       151,       164,       177,       190,
         203,       217,       231,       245,       260,       275,       291,       308,
         326,       344,       363,       382,       403,       425,       447,       471,
         495,       521,       548,       576,       606,       636,       669,       702,
         738,       775,       814,       854,       897,       941,       987,       259,
         272,       285,       299,       314,       329,       345,       362,       379,
         398,       417,       437,       458,       480,       504,       528,       553,
         580,       608,       637,       667,       699,       733,       768,       804
  };
  static unsigned char EOETF_700_bend[64] =
  {
          22,         9,         8,         7,         7,         6,         6,         7,
           7,         7,         7,         7,         8,         8,         8,         9,
           9,         9,        10,        10,        11,        11,        12,        12,
          13,        13,        14,        14,        15,        16,        17,        17,
          18,        19,        20,        21,        22,        23,        24,         6,
           7,         7,         7,         7,         8,         8,         9,         9,
           9,        10,        10,        11,        11,        12,        12,        13,
          14,        14,        15,        16,        16,        17,        18,        19
  };
  static unsigned char EOETF_700_shl[64] =
  {
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         1,
           1,         1,         1,         1,         1,         1,         1,         1,
           1,         1,         1,         1,         1,         1,         1,         1,
           1,         1,         1,         1,         1,         1,         1,         1
  };

  return EOTFtoSqrt_quadrint(EOETF_700_base, EOETF_700_slope, EOETF_700_bend, EOETF_700_shl, (unsigned short)(x_in));
}

/* EOTF and Sqrt: L_HDR = 1000 nit */
unsigned int EOTFtoSqrt_quadrint_1000(unsigned int x_in)
{
  static unsigned short EOETF_1000_base[64] =
  {
           0,        71,       166,       277,       401,       537,       685,       846,
        1018,      1204,      1401,      1612,      1837,      2076,      2330,      2600,
        2885,      3187,      3507,      3846,      4203,      4581,      4980,      5401,
        5846,      6315,      6809,      7330,      7880,      8459,      9069,      9711,
       10387,     11099,     11849,     12638,     13469,     14342,     15262,     16229,
        4312,      4579,      4860,      5156,      5467,      5794,      6138,      6499,
        6879,      7279,      7698,      8139,      8603,      9090,      9602,     10140,
       10705,     11298,     11922,     12577,     13265,     13989,     14748,     15546
  };
  static unsigned short EOETF_1000_slope[64] =
  {
          71,        96,       111,       124,       136,       148,       160,       173,
         185,       198,       211,       225,       239,       254,       269,       285,
         302,       320,       338,       358,       378,       399,       421,       444,
         469,       494,       521,       549,       579,       610,       642,       676,
         712,       750,       789,       830,       874,       919,       967,      1017,
         267,       281,       296,       311,       327,       344,       361,       380,
         399,       420,       441,       464,       487,       512,       538,       565,
         594,       624,       655,       688,       723,       760,       798,       838
  };
  static unsigned char EOETF_1000_bend[64] =
  {
          20,         9,         7,         6,         6,         6,         6,         6,
           6,         7,         7,         7,         7,         8,         8,         8,
           9,         9,         9,        10,        10,        11,        11,        12,
          12,        13,        14,        14,        15,        16,        17,        17,
          18,        19,        20,        21,        22,        23,        24,        26,
           7,         7,         7,         8,         8,         9,         9,         9,
          10,        10,        11,        11,        12,        13,        13,        14,
          15,        15,        16,        17,        18,        19,        20,        21
  };
  static unsigned char EOETF_1000_shl[64] =
  {
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           1,         1,         1,         1,         1,         1,         1,         1,
           1,         1,         1,         1,         1,         1,         1,         1,
           1,         1,         1,         1,         1,         1,         1,         1
  };

  return EOTFtoSqrt_quadrint(EOETF_1000_base, EOETF_1000_slope, EOETF_1000_bend, EOETF_1000_shl, (unsigned short)(x_in));
}

/* EOTF and Sqrt: L_HDR = 2000 nit */
unsigned int EOTFtoSqrt_quadrint_2000(unsigned int x_in)
{
  static unsigned short EOETF_2000_base[64] =
  {
           0,        56,       133,       222,       323,       433,       555,       686,
         829,       982,      1147,      1324,      1512,      1714,      1930,      2159,
        2404,      2664,      2941,      3235,      3547,      3878,      4230,      4603,
        4998,      5417,      5862,      6332,      6830,      7358,      7916,      8507,
        9132,      9794,     10494,     11234,     12016,     12844,     13719,     14644,
       15621,      4164,      4437,      4725,      5030,      5352,      5692,      6051,
        6431,      6832,      7255,      7702,      8174,      8673,      9200,      9756,
       10343,     10963,     11617,     12308,     13037,     13807,     14620,     15478
  };
  static unsigned short EOETF_2000_slope[64] =
  {
          56,        77,        89,       100,       111,       121,       132,       142,
         153,       165,       177,       189,       202,       215,       230,       244,
         260,       277,       294,       312,       331,       352,       373,       395,
         419,       444,       470,       498,       527,       558,       591,       625,
         662,       700,       740,       783,       828,       875,       925,       978,
        1033,       273,       288,       305,       322,       340,       359,       380,
         401,       423,       447,       472,       499,       527,       556,       587,
         620,       654,       691,       729,       770,       813,       858,       906
  };
  static unsigned char EOETF_2000_bend[64] =
  {
          16,         7,         6,         5,         5,         5,         5,         5,
           6,         6,         6,         6,         7,         7,         7,         8,
           8,         8,         9,         9,        10,        10,        11,        12,
          12,        13,        14,        14,        15,        16,        17,        18,
          19,        20,        21,        22,        23,        24,        26,        27,
          29,         8,         8,         8,         9,         9,        10,        10,
          11,        12,        12,        13,        14,        14,        15,        16,
          17,        18,        19,        20,        21,        22,        23,        24
  };
  static unsigned char EOETF_2000_shl[64] =
  {
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         1,         1,         1,         1,         1,         1,         1,
           1,         1,         1,         1,         1,         1,         1,         1,
           1,         1,         1,         1,         1,         1,         1,         1
  };

  return EOTFtoSqrt_quadrint(EOETF_2000_base, EOETF_2000_slope, EOETF_2000_bend, EOETF_2000_shl, (unsigned short)(x_in));
}

/* EOTF and Sqrt: L_HDR = 4000 nit */
unsigned int EOTFtoSqrt_quadrint_4000(unsigned int x_in)
{
  static unsigned short EOETF_4000_base[64] =
  {
           0,        45,       105,       177,       257,       347,       445,       552,
         669,       795,       931,      1077,      1235,      1404,      1585,      1780,
        1987,      2210,      2447,      2700,      2971,      3260,      3567,      3895,
        4245,      4617,      5013,      5435,      5883,      6361,      6869,      7409,
        7984,      8594,      9244,      9934,     10667,     11446,     12274,     13154,
       14088,     15080,     16134,      4313,      4610,      4926,      5261,      5616,
        5994,      6394,      6820,      7271,      7750,      8258,      8798,      9371,
        9978,     10623,     11307,     12033,     12804,     13621,     14488,     15408
  };
  static unsigned short EOETF_4000_slope[64] =
  {
          45,        61,        71,        81,        89,        98,       107,       116,
         126,       136,       147,       158,       169,       181,       194,       208,
         222,       237,       253,       271,       289,       308,       328,       349,
         372,       396,       422,       449,       478,       508,       540,       574,
         611,       649,       690,       733,       779,       828,       879,       934,
         992,      1054,      1119,       297,       315,       335,       356,       377,
         401,       425,       451,       479,       508,       540,       573,       608,
         645,       684,       726,       770,       817,       867,       920,       976
  };
  static unsigned char EOETF_4000_bend[64] =
  {
          13,         6,         5,         4,         4,         4,         5,         5,
           5,         5,         5,         6,         6,         6,         7,         7,
           7,         8,         8,         9,         9,        10,        10,        11,
          12,        12,        13,        14,        15,        16,        17,        18,
          19,        20,        21,        22,        24,        25,        27,        28,
          30,        32,        34,         9,         9,        10,        11,        11,
          12,        13,        13,        14,        15,        16,        17,        18,
          19,        20,        22,        23,        24,        26,        27,        29
  };
  static unsigned char EOETF_4000_shl[64] =
  {
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         1,         1,         1,         1,         1,
           1,         1,         1,         1,         1,         1,         1,         1,
           1,         1,         1,         1,         1,         1,         1,         1
  };

  return EOTFtoSqrt_quadrint(EOETF_4000_base, EOETF_4000_slope, EOETF_4000_bend, EOETF_4000_shl, (unsigned short)(x_in));
}

/* EOTF and Sqrt: L_HDR = 10000 nit */
unsigned int EOTFtoSqrt_quadrint_10000(unsigned int x_in)
{
  static unsigned short EOETF_10000_base[64] =
  {
           0,        32,        77,       129,       189,       255,       329,       409,
         498,       594,       698,       812,       934,      1066,      1209,      1363,
        1529,      1708,      1900,      2106,      2327,      2565,      2821,      3095,
        3388,      3703,      4041,      4402,      4790,      5205,      5649,      6124,
        6633,      7178,      7761,      8385,      9052,      9766,     10529,     11346,
       12219,     13152,     14150,     15217,     16357,      4394,      4720,      5068,
        5440,      5838,      6263,      6717,      7202,      7720,      8274,      8866,
        9498,     10174,     10895,     11666,     12489,     13369,     14308,     15312
  };
  static unsigned short EOETF_10000_slope[64] =
  {
          32,        44,        52,        60,        66,        74,        81,        88,
          96,       104,       113,       123,       132,       143,       154,       166,
         178,       192,       206,       222,       238,       255,       274,       294,
         315,       337,       362,       387,       415,       444,       476,       509,
         545,       583,       624,       667,       714,       763,       816,       873,
         933,       998,      1067,      1140,      1219,       326,       348,       372,
         398,       425,       454,       485,       518,       554,       592,       632,
         675,       722,       771,       823,       880,       940,      1004,      1072
  };
  static unsigned char EOETF_10000_bend[64] =
  {
           9,         4,         4,         3,         3,         4,         4,         4,
           4,         4,         5,         5,         5,         5,         6,         6,
           7,         7,         7,         8,         8,         9,        10,        10,
          11,        12,        12,        13,        14,        15,        16,        17,
          18,        20,        21,        22,        24,        26,        27,        29,
          31,        33,        36,        38,        41,        11,        12,        12,
          13,        14,        15,        16,        17,        18,        20,        21,
          22,        24,        25,        27,        29,        31,        33,        35
  };
  static unsigned char EOETF_10000_shl[64] =
  {
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         0,         0,         0,
           0,         0,         0,         0,         0,         1,         1,         1,
           1,         1,         1,         1,         1,         1,         1,         1,
           1,         1,         1,         1,         1,         1,         1,         1
  };

  return EOTFtoSqrt_quadrint(EOETF_10000_base, EOETF_10000_slope, EOETF_10000_bend, EOETF_10000_shl, (unsigned short)(x_in));
}

/******************************************************************************
 * ST2084 to OETF
 ******************************************************************************/

unsigned short ST2084toOETF_max_e_brightness_input_table[201] = {
         0,     37213,     32247,     29827,     28291,     27191,     26347,     25669,
     25107,     24629,     24216,     23853,     23530,     23241,     22979,     22740,
     22520,     22318,     22130,     21956,     21792,     21639,     21495,     21359,
     21231,     21109,     20993,     20883,     20778,     20677,     20581,     20489,
     20401,     20316,     20234,     20156,     20080,     20007,     19936,     19867,
     19801,     19737,     19675,     19615,     19556,     19499,     19444,     19390,
     19337,     19286,     19237,     19188,     19141,     19095,     19050,     19006,
     18963,     18921,     18880,     18839,     18800,     18762,     18724,     18687,
     18650,     18615,     18580,     18546,     18512,     18479,     18447,     18415,
     18384,     18353,     18323,     18294,     18264,     18236,     18208,     18180,
     18153,     18126,     18099,     18073,     18048,     18022,     17997,     17973,
     17949,     17925,     17901,     17878,     17855,     17833,     17810,     17788,
     17767,     17745,     17724,     17703,     17683,     17663,     17642,     17623,
     17603,     17584,     17565,     17546,     17527,     17509,     17490,     17472,
     17455,     17437,     17419,     17402,     17385,     17368,     17352,     17335,
     17319,     17303,     17287,     17271,     17255,     17239,     17224,     17209,
     17194,     17179,     17164,     17150,     17135,     17121,     17106,     17092,
     17078,     17065,     17051,     17037,     17024,     17010,     16997,     16984,
     16971,     16958,     16946,     16933,     16920,     16908,     16896,     16883,
     16871,     16859,     16847,     16835,     16824,     16812,     16800,     16789,
     16778,     16766,     16755,     16744,     16733,     16722,     16711,     16700,
     16690,     16679,     16668,     16658,     16648,     16637,     16627,     16617,
     16607,     16597,     16587,     16577,     16567,     16557,     16548,     16538,
     16528,     16519,     16510,     16500,     16491,     16482,     16473,     16463,
     16454,     16445,     16436,     16428,     16419,     16410,     16401,     16393,
     16384
};

unsigned short ST2084toOETF_alpha_low_table[201] = {
     16384,         0,         0,         0,      9363,      4132,         0,     12655,
      9477,      6700,      4229,      1997,         0,     13785,     11408,      9194,
      7126,      5188,      3364,      1650,         0,     15648,     14956,     14294,
     13661,     13055,     12473,     11912,     11372,     10851,     10347,      9860,
      9387,      8929,      8485,      8053,      7633,      7225,      6827,      6439,
      6061,      5692,      5332,      4979,      4635,      4298,      3968,      3645,
      3329,      3019,      2715,      2418,      2127,      1842,      1561,      1286,
      1015,       749,       487,       235,         0,     15979,     15593,     15223,
     14859,     14501,     14147,     13799,     13456,     13117,     12783,     12454,
     12128,     11807,     11491,     11178,     10869,     10564,     10262,      9964,
      9669,      9378,      9090,      8805,      8523,      8245,      7969,      7696,
      7426,      7159,      6895,      6633,      6375,      6118,      5864,      5613,
      5364,      5117,      4873,      4631,      4391,      4154,      3918,      3684,
      3452,      3222,      2995,      2769,      2545,      2323,      2104,      1887,
      1672,      1458,      1246,      1036,       828,       621,       416,       212,
         9,     16134,     15874,     15617,     15360,     15106,     14853,     14602,
     14353,     14106,     13861,     13617,     13376,     13135,     12897,     12660,
     12425,     12191,     11960,     11730,     11501,     11274,     11049,     10825,
     10603,     10382,     10162,      9944,      9727,      9511,      9297,      9084,
      8872,      8661,      8452,      8244,      8036,      7830,      7625,      7421,
      7218,      7016,      6815,      6616,      6417,      6220,      6025,      5830,
      5636,      5444,      5252,      5062,      4874,      4688,      4503,      4319,
      4136,      3954,      3772,      3591,      3412,      3233,      3055,      2878,
      2702,      2527,      2353,      2180,      2007,      1836,      1665,      1495,
      1326,      1158,       991,       824,       659,       493,       329,       164,
         0
};

unsigned short ST2084toOETF_alpha_mid_table[201] = {
     16384,         0,         0,         0,      9774,      4499,         0,     12934,
      9856,      7076,      4525,      2164,         0,     13940,     11637,      9463,
      7399,      5433,      3553,      1740,         0,     15721,     15090,     14484,
     13899,     13334,     12787,     12257,     11742,     11242,     10755,     10282,
      9819,      9369,      8929,      8499,      8080,      7669,      7266,      6872,
      6486,      6108,      5736,      5372,      5014,      4662,      4316,      3975,
      3640,      3311,      2987,      2669,      2355,      2046,      1742,      1442,
      1146,       854,       566,       282,         0,     16025,     15669,     15315,
     14965,     14618,     14276,     13938,     13605,     13275,     12948,     12626,
     12306,     11991,     11679,     11370,     11064,     10762,     10463,     10166,
      9873,      9583,      9295,      9011,      8729,      8450,      8174,      7901,
      7630,      7362,      7095,      6831,      6570,      6310,      6053,      5798,
      5545,      5293,      5044,      4797,      4553,      4309,      4068,      3829,
      3591,      3355,      3121,      2888,      2658,      2428,      2201,      1975,
      1750,      1528,      1307,      1087,       869,       652,       437,       223,
        13,     16146,     15894,     15645,     15397,     15152,     14907,     14665,
     14423,     14183,     13945,     13708,     13473,     13239,     13006,     12774,
     12544,     12316,     12088,     11862,     11637,     11413,     11191,     10970,
     10750,     10531,     10314,     10097,      9882,      9668,      9455,      9243,
      9032,      8823,      8615,      8408,      8203,      7998,      7794,      7592,
      7391,      7190,      6991,      6792,      6595,      6398,      6203,      6008,
      5814,      5620,      5426,      5234,      5042,      4851,      4661,      4472,
      4284,      4096,      3910,      3724,      3538,      3355,      3171,      2988,
      2806,      2625,      2444,      2265,      2086,      1908,      1730,      1553,
      1377,      1202,      1028,       855,       683,       512,       340,       170,
         0
};

unsigned short ST2084toOETF_alpha_high_table[201] = {
     16384,         0,         0,         0,     10286,      4913,         0,     13230,
     10271,      7498,      4885,      2398,         0,     14053,     11816,      9669,
      7602,      5608,      3682,      1821,         0,     15801,     15230,     14669,
     14120,     13586,     13065,     12557,     12061,     11575,     11100,     10635,
     10179,      9733,      9294,      8865,      8443,      8028,      7621,      7220,
      6826,      6439,      6057,      5682,      5312,      4947,      4588,      4234,
      3884,      3540,      3201,      2865,      2534,      2207,      1881,      1559,
      1242,       927,       615,       306,         0,     16035,     15690,     15348,
     15010,     14676,     14344,     14016,     13691,     13369,     13050,     12734,
     12421,     12111,     11804,     11500,     11199,     10900,     10604,     10310,
     10018,      9730,      9444,      9160,      8878,      8599,      8323,      8048,
      7775,      7505,      7236,      6970,      6706,      6443,      6183,      5925,
      5668,      5413,      5161,      4909,      4659,      4412,      4166,      3921,
      3679,      3437,      3198,      2959,      2723,      2488,      2255,      2023,
      1792,      1563,      1335,      1109,       884,       661,       439,       219,
         1,     16136,     15889,     15645,     15400,     15158,     14917,     14678,
     14439,     14202,     13966,     13731,     13498,     13266,     13035,     12805,
     12577,     12350,     12124,     11899,     11676,     11453,     11232,     11012,
     10793,     10575,     10358,     10142,      9928,      9714,      9502,      9290,
      9080,      8870,      8662,      8455,      8248,      8043,      7838,      7635,
      7432,      7230,      7030,      6830,      6631,      6433,      6236,      6040,
      5844,      5649,      5456,      5263,      5071,      4879,      4689,      4500,
      4311,      4123,      3935,      3749,      3563,      3378,      3194,      3010,
      2828,      2645,      2464,      2283,      2104,      1924,      1746,      1568,
      1391,      1214,      1039,       864,       690,       517,       344,       171,
         0
};

static short ST2084toOETF_quadrint(short EOETF_base[64], short EOETF_slope[64], short EOETF_bend[64], unsigned char EOETF_shl[64], unsigned short Ei)
{
  unsigned short addr;
  unsigned short delta;
  short Lr;
  short Li;

  addr  = Ei >> 10;
  delta = Ei  & 0x03ff;
  Lr = (((short)EOETF_base[(int)addr]) << 2) +
    ((((unsigned int)delta) * ( (((short)EOETF_slope[(int)addr]) << 1) -
    (( ( ((unsigned int)1023) - ((unsigned int)delta) ) * EOETF_bend[(int)addr]) >> 9) )) >> 9);

  if (Lr >= 0)
    Li = (short) (((Lr << ((unsigned char)(EOETF_shl [(int)addr]) << 1)) + 2) >> 2);
  else
    Li = (short) -((((-Lr) << ((unsigned char)(EOETF_shl [(int)addr]) << 1)) + 2) >> 2);

  return Li;
}

/* ST2084 and OETF: L_HDR = 100 nit */
unsigned int ST2084toOETF_quadrint_100(unsigned int x_in)
{
  static short EOETF_100_base_[64] =
  {
    0,       673,       817,       869,       881,       871,       848,       817,
    782,       745,       707,       669,       632,       595,       560,       526,
    494,       463,       435,       407,       382,       357,       335,       313,
    293,       275,       257,       241,       226,       211,       198,       185,
    173,       162,       152,       142,       132,       123,       115,       107,
    100,        92,        85,        79,        73,        67,        61,        55,
    50,        45,        40,        36,        31,        27,        23,        19,
    16,        13,        10,         8,         5,         3,         2,         1
  };
  static short EOETF_100_slope_[64] =
  {
    168,       143,        53,        12,       -10,       -23,       -31,       -35,
    -37,       -38,       -38,       -37,       -36,       -35,       -34,       -32,
    -31,       -29,       -27,       -26,       -24,       -23,       -21,       -20,
    -19,       -17,       -16,       -15,       -14,       -13,       -13,       -12,
    -11,       -11,       -10,        -9,        -9,        -8,        -8,        -8,
    -7,        -7,        -7,        -6,        -6,        -6,        -6,        -5,
    -5,        -5,        -5,        -4,        -4,        -4,        -4,        -3,
    -3,        -3,        -3,        -2,        -2,        -2,        -1,        -1
  };
  static short EOETF_100_bend_[64] =
  {
    -177,       -70,       -28,       -14,        -8,        -5,        -3,        -2,
    -1,         0,         0,         0,         1,         1,         1,         1,
    1,         1,         1,         1,         1,         1,         1,         1,
    1,         1,         1,         1,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0
  };
  static unsigned char EOETF_100_shl_[64] =
  {
    1,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0
  };

  return ST2084toOETF_quadrint(EOETF_100_base_, EOETF_100_slope_, EOETF_100_bend_, EOETF_100_shl_, (unsigned short)(x_in));
}

/* ST2084 and OETF: L_HDR = 150 nit */
unsigned int ST2084toOETF_quadrint_150(unsigned int x_in)
{
  static short EOETF_150_base_[64] =
  {
    0,       639,       767,       809,       813,       797,       770,       737,
    701,       663,       625,       587,       551,       515,       482,       450,
    420,       391,       364,       339,       316,       294,       274,       255,
    237,       221,       206,       191,       178,       165,       154,       143,
    133,       123,       114,       106,        97,        90,        83,        76,
    69,        63,        57,        51,        46,        41,        36,        31,
    26,        22,        18,        15,        11,         8,         5,         3,
    1,        -1,        -2,        -3,        -4,        -4,        -3,        -2
  };
  static short EOETF_150_slope_[64] =
  {
    160,       128,        42,         4,       -16,       -27,       -33,       -36,
    -38,       -38,       -38,       -37,       -35,       -34,       -32,       -30,
    -28,       -27,       -25,       -23,       -22,       -20,       -19,       -18,
    -16,       -15,       -14,       -13,       -12,       -12,       -11,       -10,
    -10,        -9,        -9,        -8,        -8,        -7,        -7,        -7,
    -6,        -6,        -6,        -5,        -5,        -5,        -5,        -4,
    -4,        -4,        -4,        -3,        -3,        -3,        -2,        -2,
    -2,        -1,        -1,         0,         0,         1,         1,         2
  };
  static short EOETF_150_bend_[64] =
  {
    -172,       -66,       -26,       -13,        -7,        -4,        -2,        -1,
    0,         0,         0,         1,         1,         1,         1,         1,
    1,         1,         1,         1,         1,         1,         1,         1,
    1,         1,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0
  };
  static unsigned char EOETF_150_shl_[64] =
  {
    1,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0
  };

  return ST2084toOETF_quadrint(EOETF_150_base_, EOETF_150_slope_, EOETF_150_bend_, EOETF_150_shl_, (unsigned short)(x_in));
}

/* ST2084 and OETF: L_HDR = 300 nit */
unsigned int ST2084toOETF_quadrint_300(unsigned int x_in)
{
  static short EOETF_300_base_[64] =
  {
    0,       586,       690,       716,       709,       686,       653,       617,
    578,       539,       501,       465,       430,       397,       365,       336,
    309,       284,       260,       238,       218,       200,       182,       166,
    151,       138,       125,       113,       102,        92,        82,        73,
    64,        56,        48,        41,        34,        27,        21,        15,
    9,         3,        -2,        -7,       -11,       -16,       -20,       -23,
    -27,       -30,       -32,       -34,       -36,       -37,       -38,       -38,
    -37,       -35,       -33,       -30,       -26,       -21,       -15,        -8
  };
  static short EOETF_300_slope_[64] =
  {
    147,       104,        26,        -7,       -24,       -32,       -37,       -39,
    -39,       -38,       -37,       -35,       -33,       -31,       -29,       -27,
    -25,       -23,       -22,       -20,       -19,       -17,       -16,       -15,
    -14,       -13,       -12,       -11,       -10,       -10,        -9,        -9,
    -8,        -8,        -7,        -7,        -7,        -6,        -6,        -6,
    -6,        -5,        -5,        -5,        -4,        -4,        -4,        -3,
    -3,        -3,        -2,        -2,        -1,        -1,         0,         1,
    1,         2,         3,         4,         5,         6,         7,         8
  };
  static short EOETF_300_bend_[64] =
  {
    -163,       -61,       -23,       -11,        -6,        -3,        -1,         0,
    0,         1,         1,         1,         1,         1,         1,         1,
    1,         1,         1,         1,         1,         1,         1,         1,
    1,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         1,         1,         1
  };
  static unsigned char EOETF_300_shl_[64] =
  {
    1,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0
  };

  return ST2084toOETF_quadrint(EOETF_300_base_, EOETF_300_slope_, EOETF_300_bend_, EOETF_300_shl_, (unsigned short)(x_in));
}

/* ST2084 and OETF: L_HDR = 600 nit */
unsigned int ST2084toOETF_quadrint_600(unsigned int x_in)
{
  static short EOETF_600_base_[64] =
  {
    0,       539,       622,       635,       618,       587,       550,       511,
    471,       431,       393,       357,       323,       292,       262,       235,
    210,       186,       165,       145,       127,       110,        94,        80,
    66,        53,        42,        30,        20,        10,         1,        -8,
    -17,       -25,       -33,       -41,       -48,       -55,       -61,       -68,
    -73,       -79,       -84,       -89,       -93,       -97,      -101,      -104,
    -106,      -107,      -108,      -108,      -107,      -105,      -103,       -99,
    -94,       -87,       -80,       -70,       -60,       -47,       -33,       -18
  };
  static short EOETF_600_slope_[64] =
  {
    135,        83,        12,       -17,       -30,       -37,       -40,       -40,
    -39,       -38,       -36,       -34,       -32,       -29,       -27,       -25,
    -23,       -21,       -20,       -18,       -17,       -16,       -15,       -14,
    -13,       -12,       -11,       -10,       -10,        -9,        -9,        -9,
    -8,        -8,        -8,        -7,        -7,        -7,        -6,        -6,
    -6,        -5,        -5,        -4,        -4,        -3,        -3,        -2,
    -2,        -1,         0,         1,         2,         3,         4,         5,
    6,         8,         9,        11,        12,        14,        16,        18
  };
  static short EOETF_600_bend_[64] =
  {
    -156,       -56,       -21,       -10,        -5,        -2,        -1,         0,
    1,         1,         1,         1,         1,         1,         1,         1,
    1,         1,         1,         1,         1,         1,         1,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         1,         1,         1,
    1,         1,         1,         1,         1,         1,         1,         1
  };
  static unsigned char EOETF_600_shl_[64] =
  {
    1,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0
  };

  return ST2084toOETF_quadrint(EOETF_600_base_, EOETF_600_slope_, EOETF_600_bend_, EOETF_600_shl_, (unsigned short)(x_in));
}

/* ST2084 and OETF: L_HDR = 1000 nit */
unsigned int ST2084toOETF_quadrint_1000 (unsigned int x_in)
{
  static short EOETF_1000_base_[64] =
  {
    0,       507,       576,       579,       556,       521,       481,       439,
    397,       357,       319,       283,       249,       218,       189,       162,
    138,       115,        94,        75,        57,        40,        25,        10,
    -4,       -17,       -29,       -41,       -52,       -62,       -73,       -82,
    -92,      -101,      -110,      -118,      -126,      -134,      -141,      -148,
    -155,      -161,      -167,      -172,      -176,      -180,      -182,      -184,
    -185,      -186,      -185,      -182,      -179,      -174,      -168,      -160,
    -151,      -139,      -126,      -111,       -94,       -74,       -52,       -27
  };
  static short EOETF_1000_slope_[64] =
  {
    127,        69,         3,       -23,       -35,       -40,       -42,       -42,
    -40,       -38,       -36,       -34,       -31,       -29,       -27,       -25,
    -23,       -21,       -19,       -18,       -17,       -16,       -15,       -14,
    -13,       -12,       -12,       -11,       -11,       -10,       -10,        -9,
    -9,        -9,        -8,        -8,        -8,        -7,        -7,        -7,
    -6,        -6,        -5,        -4,        -4,        -3,        -2,        -1,
    0,         1,         2,         3,         5,         6,         8,        10,
    11,        13,        15,        17,        20,        22,        25,        27
  };
  static short EOETF_1000_bend_[64] =
  {
    -151,       -53,       -19,        -8,        -4,        -2,         0,         0,
    1,         1,         1,         1,         1,         1,         1,         1,
    1,         1,         1,         1,         1,         1,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    1,         1,         1,         1,         1,         1,         1,         1,
    1,         1,         1,         1,         1,         1,         1,         1
  };
  static unsigned char EOETF_1000_shl_[64] =
  {
    1,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0
  };

  return ST2084toOETF_quadrint(EOETF_1000_base_, EOETF_1000_slope_, EOETF_1000_bend_, EOETF_1000_shl_, (unsigned short)(x_in));
}


/* ST2084 and OETF: L_HDR = 3000 nit */
unsigned int ST2084toOETF_quadrint_3000(unsigned int x_in)
{
  static short EOETF_3000_base_[64] =
  {
    0,       445,       486,       470,       434,       388,       341,       293,
    247,       204,       163,       125,        90,        57,        27,        -2,
    -28,       -52,       -76,       -97,      -118,      -138,      -156,      -174,
    -192,      -209,      -225,      -241,      -256,      -271,      -286,      -300,
    -314,      -328,      -341,      -353,      -365,      -376,      -387,      -397,
    -406,      -413,      -420,      -426,      -430,      -432,      -433,      -433,
    -430,      -426,      -419,      -410,      -399,      -385,      -368,      -348,
    -324,      -298,      -268,      -234,      -196,      -154,      -107,       -56
  };
  static short EOETF_3000_slope_[64] =
  {
    111,        41,       -16,       -37,       -45,       -48,       -48,       -46,
    -43,       -41,       -38,       -35,       -33,       -30,       -28,       -26,
    -25,       -23,       -22,       -21,       -20,       -19,       -18,       -17,
    -17,       -16,       -16,       -15,       -15,       -15,       -14,       -14,
    -13,       -13,       -12,       -12,       -11,       -11,       -10,        -9,
    -8,        -7,        -5,        -4,        -3,        -1,         1,         2,
    5,         7,         9,        11,        14,        17,        20,        23,
    27,        30,        34,        38,        42,        47,        51,        56
  };
  static short EOETF_3000_bend_[64] =
  {
    -140,       -46,       -16,        -6,        -2,         0,         1,         1,
    1,         1,         1,         1,         1,         1,         1,         1,
    1,         1,         1,         1,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    1,         1,         1,         1,         1,         1,         1,         1,
    1,         1,         1,         1,         1,         1,         2,         2,
    2,         2,         2,         2,         2,         2,         2,         2
  };
  static unsigned char EOETF_3000_shl_[64] =
  {
    1,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0
  };

  return ST2084toOETF_quadrint(EOETF_3000_base_, EOETF_3000_slope_, EOETF_3000_bend_, EOETF_3000_shl_, (unsigned short)(x_in));
}

/* ST2084 and OETF: L_HDR = 6000 nit */
unsigned int ST2084toOETF_quadrint_6000(unsigned int x_in)
{
  static short EOETF_6000_base_[64] =
  {
         0,       409,       434,       406,       360,       308,       255,       203,
       153,       106,        62,        20,       -18,       -54,       -87,      -119,
      -149,      -177,      -204,      -229,      -254,      -278,      -301,      -324,
      -346,      -367,      -388,      -409,      -429,      -449,      -468,      -487,
      -506,      -523,      -541,      -557,      -572,      -587,      -600,      -612,
      -623,      -632,      -640,      -646,      -649,      -651,      -651,      -647,
      -642,      -633,      -621,      -606,      -587,      -565,      -539,      -508,
      -473,      -433,      -389,      -339,      -283,      -222,      -155,       -81
  };
  static short EOETF_6000_slope_[64] =
  {
       102,        24,       -28,       -46,       -52,       -53,       -52,       -50,
       -47,       -44,       -41,       -38,       -36,       -34,       -32,       -30,
       -28,       -27,       -26,       -25,       -24,       -23,       -23,       -22,
       -22,       -21,       -21,       -20,       -20,       -19,       -19,       -18,
       -18,       -17,       -16,       -15,       -14,       -13,       -12,       -11,
        -9,        -8,        -6,        -4,        -2,         1,         3,         6,
         9,        12,        15,        19,        22,        26,        31,        35,
        40,        45,        50,        55,        61,        67,        74,        81
  };
  static short EOETF_6000_bend_[64] =
  {
     -135,       -43,       -14,        -5,        -2,         0,         1,         1,
         1,         1,         1,         1,         1,         1,         1,         1,
         1,         1,         1,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         1,         1,         1,         1,
         1,         1,         1,         1,         1,         1,         1,         1,
         1,         2,         2,         2,         2,         2,         2,         2,
         2,         3,         3,         3,         3,         3,         3,         3
  };
  static unsigned char EOETF_6000_shl_[64] =
  {
    1,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0
  };

  return ST2084toOETF_quadrint(EOETF_6000_base_, EOETF_6000_slope_, EOETF_6000_bend_, EOETF_6000_shl_, (unsigned short)(x_in));
}

/* ST2084 and OETF: L_HDR = 10000 nit */
unsigned int ST2084toOETF_quadrint_10000(unsigned int x_in)
{
  static short EOETF_10000_base_[64] =
  {
         0,       384,       396,       360,       307,       249,       191,       135,
        81,        31,       -17,       -61,      -103,      -142,      -180,      -215,
      -248,      -280,      -311,      -341,      -370,      -398,      -425,      -452,
      -479,      -505,      -531,      -556,      -581,      -605,      -629,      -652,
      -674,      -696,      -716,      -736,      -755,      -772,      -787,      -802,
      -814,      -824,      -833,      -839,      -842,      -843,      -841,      -835,
      -827,      -814,      -798,      -777,      -753,      -723,      -688,      -649,
      -603,      -552,      -495,      -431,      -360,      -282,      -196,      -102
  };
  static short EOETF_10000_slope_[64] =
  {
        96,        12,       -36,       -53,       -58,       -58,       -56,       -54,
       -51,       -48,       -45,       -42,       -39,       -37,       -35,       -33,
       -32,       -31,       -30,       -29,       -28,       -28,       -27,       -27,
       -26,       -26,       -25,       -25,       -24,       -24,       -23,       -22,
       -22,       -21,       -20,       -18,       -17,       -16,       -14,       -12,
       -10,        -8,        -6,        -3,        -1,         2,         5,         9,
        12,        16,        20,        25,        30,        35,        40,        45,
        51,        57,        64,        71,        78,        86,        94,       102
  };
  static short EOETF_10000_bend_[64] =
  {
     -131,       -41,       -13,        -4,        -1,         0,         1,         1,
         2,         2,         1,         1,         1,         1,         1,         1,
         1,         1,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         1,         1,         1,         1,         1,         1,
         1,         1,         1,         1,         1,         2,         2,         2,
         2,         2,         2,         2,         2,         3,         3,         3,
         3,         3,         3,         4,         4,         4,         4,         4
  };
  static unsigned char EOETF_10000_shl_[64] =
  {
    1,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0,
    0,         0,         0,         0,         0,         0,         0,         0
  };

  return ST2084toOETF_quadrint(EOETF_10000_base_, EOETF_10000_slope_, EOETF_10000_bend_, EOETF_10000_shl_, (unsigned short)(x_in));
}

/******************************************************************************
 * EOTF to PQ
 ******************************************************************************/

#define CLIP(x, x_min, x_max) (((x)<(x_min)) ? (x_min) : (((x)>(x_max)) ? (x_max) : (x)))

enum { SHIFT = 16 };

unsigned short EOTFtoPQ_max_e_brightness_output_table[201] =  {
         0,      7214,      8324,      9000,      9489,      9872,     10189,     10458,
     10692,     10899,     11085,     11254,     11408,     11550,     11682,     11805,
     11920,     12028,     12130,     12226,     12318,     12405,     12488,     12568,
     12644,     12717,     12787,     12854,     12919,     12982,     13043,     13101,
     13158,     13213,     13266,     13318,     13368,     13417,     13465,     13511,
     13557,     13601,     13644,     13686,     13727,     13767,     13806,     13844,
     13882,     13918,     13954,     13990,     14024,     14058,     14091,     14124,
     14156,     14187,     14218,     14249,     14278,     14308,     14337,     14365,
     14393,     14420,     14447,     14474,     14500,     14526,     14552,     14577,
     14602,     14626,     14650,     14674,     14697,     14720,     14743,     14766,
     14788,     14810,     14831,     14853,     14874,     14895,     14915,     14936,
     14956,     14976,     14995,     15015,     15034,     15053,     15072,     15090,
     15109,     15127,     15145,     15163,     15181,     15198,     15215,     15232,
     15249,     15266,     15283,     15299,     15315,     15332,     15348,     15363,
     15379,     15395,     15410,     15425,     15441,     15456,     15470,     15485,
     15500,     15514,     15529,     15543,     15557,     15571,     15585,     15599,
     15612,     15626,     15639,     15653,     15666,     15679,     15692,     15705,
     15718,     15731,     15743,     15756,     15768,     15781,     15793,     15805,
     15817,     15829,     15841,     15853,     15865,     15876,     15888,     15899,
     15911,     15922,     15934,     15945,     15956,     15967,     15978,     15989,
     16000,     16010,     16021,     16032,     16042,     16053,     16063,     16074,
     16084,     16094,     16104,     16115,     16125,     16135,     16145,     16154,
     16164,     16174,     16184,     16193,     16203,     16212,     16222,     16231,
     16241,     16250,     16259,     16269,     16278,     16287,     16296,     16305,
     16314,     16323,     16332,     16341,     16349,     16358,     16367,     16375,
     16384
};

unsigned short EOTFtoPQ_alpha_low_table[201] = {
     16384,         0,         0,         0,      9791,      4511,         0,     13083,
     10032,      7239,      4674,      2284,         0,     14005,     11756,      9602,
      7532,      5536,      3626,      1782,         0,     15790,     15169,     14570,
     13999,     13450,     12917,     12400,     11896,     11405,     10926,     10458,
     10002,      9554,      9117,      8689,      8269,      7857,      7453,      7057,
      6667,      6284,      5908,      5538,      5174,      4816,      4463,      4117,
      3777,      3443,      3114,      2793,      2478,      2169,      1863,      1560,
      1260,       952,       628,       312,         0,     16040,     15699,     15362,
     15027,     14696,     14369,     14045,     13721,     13398,     13079,     12762,
     12449,     12139,     11832,     11527,     11225,     10926,     10630,     10336,
     10045,      9757,      9471,      9187,      8905,      8626,      8350,      8075,
      7803,      7532,      7264,      6998,      6734,      6472,      6212,      5953,
      5697,      5443,      5190,      4938,      4689,      4442,      4196,      3952,
      3709,      3469,      3229,      2991,      2755,      2520,      2287,      2052,
      1818,      1586,      1355,      1125,       896,       669,       444,       220,
         1,     16136,     15892,     15650,     15409,     15170,     14932,     14696,
     14460,     14226,     13993,     13762,     13531,     13302,     13074,     12847,
     12620,     12396,     12172,     11949,     11727,     11506,     11286,     11067,
     10849,     10632,     10416,     10201,      9987,      9774,      9562,      9350,
      9140,      8931,      8722,      8514,      8307,      8101,      7896,      7692,
      7489,      7286,      7084,      6883,      6683,      6484,      6285,      6087,
      5890,      5694,      5498,      5304,      5110,      4917,      4724,      4532,
      4341,      4150,      3961,      3772,      3584,      3396,      3209,      3023,
      2837,      2653,      2469,      2286,      2104,      1923,      1743,      1563,
      1384,      1206,      1029,       852,       676,       500,       325,       150,
         0
};

unsigned short EOTFtoPQ_alpha_mid_table[201] = {
     16384,         0,         0,         0,     10426,      5044,         0,     13249,
     10345,      7596,      4963,      2429,         0,     14111,     11910,      9779,
      7711,      5700,      3741,      1835,         0,     15834,     15293,     14759,
     14231,     13714,     13209,     12716,     12235,     11764,     11301,     10845,
     10398,      9957,      9524,      9097,      8677,      8263,      7854,      7451,
      7054,      6661,      6274,      5892,      5514,      5141,      4772,      4407,
      4047,      3690,      3338,      2989,      2644,      2302,      1965,      1629,
      1298,       970,       644,       322,         0,     16052,     15720,     15392,
     15065,     14742,     14421,     14103,     13788,     13475,     13165,     12857,
     12551,     12248,     11947,     11649,     11352,     11058,     10765,     10475,
     10186,      9899,      9614,      9331,      9051,      8771,      8494,      8219,
      7945,      7673,      7404,      7135,      6868,      6603,      6340,      6078,
      5818,      5559,      5302,      5046,      4793,      4539,      4289,      4039,
      3790,      3543,      3297,      3053,      2810,      2568,      2328,      2089,
      1851,      1615,      1382,      1150,       920,       691,       463,       234,
         6,     16150,     15911,     15671,     15433,     15196,     14960,     14725,
     14491,     14258,     14028,     13799,     13571,     13344,     13119,     12894,
     12671,     12448,     12226,     12005,     11785,     11566,     11349,     11131,
     10915,     10700,     10486,     10272,     10060,      9848,      9637,      9427,
      9218,      9009,      8802,      8595,      8389,      8184,      7980,      7776,
      7573,      7372,      7170,      6970,      6770,      6571,      6373,      6175,
      5979,      5782,      5587,      5392,      5198,      5005,      4812,      4620,
      4429,      4238,      4048,      3859,      3670,      3481,      3292,      3105,
      2917,      2731,      2545,      2360,      2175,      1991,      1808,      1625,
      1442,      1261,      1079,       899,       719,       539,       360,       182,
         0
};

unsigned short EOTFtoPQ_alpha_high_table[201] = {
     16384,         0,         0,         0,     10794,      5341,         0,     13456,
     10616,      7853,      5163,      2553,         0,     14175,     12021,      9912,
      7849,      5827,      3846,      1904,         0,     15857,     15339,     14830,
     14329,     13837,     13352,     12874,     12404,     11940,     11483,     11032,
     10587,     10148,      9715,      9288,      8866,      8448,      8037,      7630,
      7227,      6830,      6436,      6047,      5662,      5282,      4905,      4532,
      4163,      3798,      3436,      3078,      2723,      2371,      2024,      1679,
      1336,       997,       662,       329,         0,     16050,     15719,     15392,
     15067,     14745,     14425,     14108,     13794,     13482,     13171,     12864,
     12560,     12256,     11956,     11657,     11361,     11066,     10774,     10484,
     10196,      9910,      9625,      9343,      9063,      8784,      8507,      8232,
      7959,      7687,      7417,      7149,      6883,      6617,      6354,      6092,
      5832,      5573,      5316,      5060,      4806,      4554,      4302,      4052,
      3804,      3556,      3311,      3066,      2823,      2581,      2340,      2101,
      1863,      1626,      1390,      1156,       922,       690,       459,       229,
         1,     16143,     15903,     15665,     15428,     15191,     14956,     14722,
     14489,     14257,     14027,     13797,     13568,     13341,     13114,     12889,
     12664,     12440,     12217,     11996,     11775,     11556,     11338,     11120,
     10903,     10687,     10473,     10259,     10046,      9834,      9623,      9412,
      9203,      8994,      8786,      8579,      8373,      8168,      7963,      7759,
      7556,      7354,      7152,      6952,      6752,      6553,      6354,      6156,
      5959,      5763,      5567,      5372,      5179,      4985,      4792,      4600,
      4409,      4218,      4028,      3838,      3650,      3462,      3274,      3087,
      2901,      2716,      2530,      2346,      2162,      1979,      1797,      1615,
      1434,      1253,      1072,       893,       714,       536,       358,       181,
         0
};

static short EOTFtoPQ_quadrint(short EOETF_base[64], short EOETF_slope[64], short EOETF_bend[64], unsigned short Ei)
{
  unsigned char addr;
  unsigned short delta;
  short Lr;
  short Li;

  addr  = Ei >> 10;
  delta = Ei  & 0x03ff;
  if (!EOETF_bend) {
      Lr = (((short)EOETF_base [(int)addr]) << 2) +
      ((((unsigned int)delta) * (((short)EOETF_slope[(int)addr]) << 1)) >> 9);
  }
  else {
    Lr = (((short)EOETF_base [(int)addr]) << 2) +
      ((((unsigned int)delta) * ( (((short)EOETF_slope[(int)addr]) << 1) -
      (( ( ((unsigned int)1023) - ((unsigned int)delta) ) * EOETF_bend[(int)addr]) >> 9) )) >> 9);
  }

  if (Lr >= 0)
    Li = ((Lr  + 2) >> 2);
  else
    Li = -(((-Lr) + 2) >> 2);

  return Li;
}

/* EOTF and PQ: L_HDR = 0 nit */
unsigned int EOTFtoPQ_quadrint_0(unsigned int x_in)
{
  return -x_in;
}

/* EOTF and PQ: L_HDR = 50 nit */
unsigned int EOTFtoPQ_quadrint_50(unsigned int x_in)
{
  static short EOETF_50_L_base_[64] =
  {
         0,       -68,      -123,      -168,      -206,      -239,      -267,      -292,
      -313,      -332,      -349,      -363,      -376,      -388,      -397,      -406,
      -414,      -420,      -426,      -430,      -434,      -438,      -441,      -443,
      -444,      -446,      -446,      -447,      -447,      -446,      -446,      -445,
      -444,      -443,      -441,      -439,      -437,      -435,      -433,      -430,
      -428,      -425,      -423,      -420,      -417,      -414,      -411,      -408,
      -404,      -401,      -398,      -394,      -391,      -388,      -384,      -381,
      -377,      -374,      -370,      -367,      -363,      -360,      -356,      -353
  };
  static short EOETF_50_L_slope_[64] =
  {
       -68,       -54,       -45,       -38,       -33,       -28,       -25,       -22,
       -19,       -17,       -15,       -13,       -11,       -10,        -9,        -8,
        -7,        -6,        -5,        -4,        -3,        -3,        -2,        -2,
        -1,        -1,         0,         0,         0,         1,         1,         1,
         1,         2,         2,         2,         2,         2,         2,         3,
         3,         3,         3,         3,         3,         3,         3,         3,
         3,         3,         3,         3,         3,         3,         3,         3,
         3,         3,         4,         4,         4,         4,         4,         4
  };
  static short EOETF_50_L_bend_[64] =
  {
         9,         5,         4,         3,         2,         2,         2,         1,
         1,         1,         1,         1,         1,         1,         1,         1,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0
  };
  static short EOETF_50_H_base_[64] =
  {
       -349,      -335,      -321,      -308,      -295,      -282,      -269,      -257,
      -246,      -234,      -224,      -213,      -203,      -194,      -185,      -176,
      -168,      -160,      -152,      -145,      -138,      -132,      -126,      -120,
      -114,      -108,      -103,       -98,       -93,       -89,       -84,       -80,
       -76,       -72,       -69,       -65,       -62,       -58,       -55,       -52,
       -49,       -46,       -44,       -41,       -38,       -36,       -33,       -31,
       -29,       -26,       -24,       -22,       -20,       -18,       -16,       -14,
       -13,       -11,        -9,        -7,        -6,        -4,        -3,        -1
  };
  static short EOETF_50_H_slope_[64] =
  {
        14,        14,        14,        13,        13,        12,        12,        12,
        11,        11,        10,        10,         9,         9,         9,         8,
         8,         8,         7,         7,         7,         6,         6,         6,
         5,         5,         5,         5,         5,         4,         4,         4,
         4,         4,         4,         3,         3,         3,         3,         3,
         3,         3,         3,         3,         3,         2,         2,         2,
         2,         2,         2,         2,         2,         2,         2,         2,
         2,         2,         2,         2,         2,         1,         1,         1
  };
  unsigned int x;

  if (x_in <= 13107) {
    x = x_in * 5;
    return EOTFtoPQ_quadrint(EOETF_50_L_base_, EOETF_50_L_slope_, EOETF_50_L_bend_, (unsigned short)x);
  }
  else {
    x = CLIP(((x_in * 10240) - 134217728 + (1<<(SHIFT-4))) >> (SHIFT-3), 0, 65535);
    return EOTFtoPQ_quadrint(EOETF_50_H_base_, EOETF_50_H_slope_, 0, (unsigned short)x);
  }
}

/* EOTF and PQ: L_HDR = 100 nit */
unsigned int EOTFtoPQ_quadrint_100(unsigned int x_in)
{
  static short EOETF_100_L_base_[64] =
  {
         0,       -77,      -137,      -186,      -227,      -261,      -290,      -315,
      -336,      -355,      -371,      -385,      -396,      -406,      -415,      -422,
      -428,      -433,      -438,      -441,      -443,      -445,      -447,      -447,
      -448,      -447,      -447,      -446,      -444,      -443,      -441,      -439,
      -436,      -434,      -431,      -428,      -425,      -422,      -419,      -415,
      -412,      -408,      -404,      -401,      -397,      -393,      -389,      -385,
      -381,      -377,      -373,      -369,      -365,      -361,      -357,      -353,
      -349,      -345,      -341,      -337,      -333,      -329,      -325,      -321
  };
  static short EOETF_100_L_slope_[64] =
  {
       -77,       -60,       -49,       -41,       -34,       -29,       -25,       -21,
       -18,       -16,       -14,       -12,       -10,        -9,        -7,        -6,
        -5,        -4,        -3,        -3,        -2,        -1,        -1,         0,
         0,         1,         1,         1,         2,         2,         2,         2,
         3,         3,         3,         3,         3,         3,         3,         4,
         4,         4,         4,         4,         4,         4,         4,         4,
         4,         4,         4,         4,         4,         4,         4,         4,
         4,         4,         4,         4,         4,         4,         4,         4
  };
  static short EOETF_100_L_bend_[64] =
  {
        12,         7,         5,         4,         3,         2,         2,         2,
         1,         1,         1,         1,         1,         1,         1,         1,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0
  };
  static short EOETF_100_H_base_[64] =
  {
      -317,      -302,      -287,      -273,      -259,      -246,      -233,      -221,
      -210,      -199,      -188,      -179,      -169,      -160,      -152,      -144,
      -137,      -129,      -123,      -116,      -110,      -104,       -99,       -94,
       -89,       -84,       -80,       -76,       -72,       -68,       -64,       -61,
       -57,       -54,       -51,       -48,       -45,       -42,       -40,       -37,
       -35,       -32,       -30,       -28,       -26,       -23,       -21,       -20,
       -18,       -16,       -14,       -13,       -11,       -10,        -8,        -7,
        -6,        -5,        -4,        -3,        -2,        -1,        -1,         0
  };
  static short EOETF_100_H_slope_[64] =
  {
        15,        15,        14,        14,        13,        13,        12,        11,
        11,        10,        10,         9,         9,         8,         8,         8,
         7,         7,         6,         6,         6,         5,         5,         5,
         5,         4,         4,         4,         4,         4,         4,         3,
         3,         3,         3,         3,         3,         3,         3,         2,
         2,         2,         2,         2,         2,         2,         2,         2,
         2,         2,         2,         2,         1,         1,         1,         1,
         1,         1,         1,         1,         1,         1,         0,         0
  };
  unsigned int x;

  if (x_in <= 13107) {
    x = x_in * 5;
    return EOTFtoPQ_quadrint(EOETF_100_L_base_, EOETF_100_L_slope_, EOETF_100_L_bend_, (unsigned short)x);
  }
  else {
    x = CLIP(((x_in * 10240) - 134217728 + (1<<(SHIFT-4))) >> (SHIFT-3), 0, 65535);
    return EOTFtoPQ_quadrint(EOETF_100_H_base_, EOETF_100_H_slope_, 0, (unsigned short)x);
  }
}

/* EOTF and PQ: L_HDR = 150 nit */
unsigned int EOTFtoPQ_quadrint_150(unsigned int x_in)
{
  static short EOETF_150_L_base_[64] =
  {
         0,       -83,      -146,      -197,      -238,      -273,      -303,      -328,
      -349,      -367,      -382,      -395,      -406,      -415,      -423,      -430,
      -435,      -439,      -442,      -444,      -446,      -447,      -447,      -447,
      -447,      -446,      -444,      -442,      -440,      -438,      -435,      -432,
      -429,      -426,      -422,      -419,      -415,      -411,      -407,      -403,
      -399,      -395,      -391,      -387,      -383,      -378,      -374,      -370,
      -365,      -361,      -356,      -352,      -348,      -343,      -339,      -335,
      -330,      -326,      -322,      -318,      -314,      -309,      -305,      -301
  };
  static short EOETF_150_L_slope_[64] =
  {
       -83,       -63,       -51,       -42,       -35,       -29,       -25,       -21,
       -18,       -15,       -13,       -11,        -9,        -8,        -6,        -5,
        -4,        -3,        -2,        -2,        -1,         0,         0,         1,
         1,         1,         2,         2,         2,         3,         3,         3,
         3,         3,         4,         4,         4,         4,         4,         4,
         4,         4,         4,         4,         4,         4,         4,         4,
         4,         4,         4,         4,         4,         4,         4,         4,
         4,         4,         4,         4,         4,         4,         4,         4
  };
  static short EOETF_150_L_bend_[64] =
  {
        13,         7,         5,         4,         3,         2,         2,         2,
         1,         1,         1,         1,         1,         1,         1,         1,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0
  };
  static short EOETF_150_H_base_[64] =
  {
      -297,      -281,      -266,      -251,      -237,      -224,      -211,      -200,
      -188,      -178,      -168,      -158,      -149,      -141,      -133,      -125,
      -118,      -111,      -105,       -99,       -93,       -88,       -83,       -78,
       -74,       -69,       -65,       -61,       -58,       -54,       -51,       -47,
       -44,       -41,       -38,       -35,       -33,       -30,       -28,       -25,
       -23,       -21,       -19,       -17,       -15,       -13,       -11,        -9,
        -8,        -6,        -5,        -3,        -2,        -1,         0,         0,
         1,         2,         2,         2,         2,         2,         1,         1
  };
  static short EOETF_150_H_slope_[64] =
  {
        16,        15,        15,        14,        13,        13,        12,        11,
        11,        10,        10,         9,         8,         8,         8,         7,
         7,         6,         6,         6,         5,         5,         5,         5,
         4,         4,         4,         4,         4,         3,         3,         3,
         3,         3,         3,         3,         3,         2,         2,         2,
         2,         2,         2,         2,         2,         2,         2,         2,
         1,         1,         1,         1,         1,         1,         1,         1,
         0,         0,         0,         0,         0,         0,        -1,        -1
  };
  unsigned int x;

  if (x_in <= 13107) {
    x = x_in * 5;
    return EOTFtoPQ_quadrint(EOETF_150_L_base_, EOETF_150_L_slope_, EOETF_150_L_bend_, (unsigned short)x);
  }
  else {
    x = CLIP(((x_in * 10240) - 134217728 + (1<<(SHIFT-4))) >> (SHIFT-3), 0, 65535);
    return EOTFtoPQ_quadrint(EOETF_150_H_base_, EOETF_150_H_slope_, 0, (unsigned short)x);
  }
}

/* EOTF and PQ: L_HDR = 300 nit */
unsigned int EOTFtoPQ_quadrint_300(unsigned int x_in)
{
  static short EOETF_300_L_base_[64] =
  {
         0,       -92,      -160,      -214,      -257,      -293,      -322,      -347,
      -367,      -384,      -398,      -410,      -419,      -427,      -433,      -438,
      -441,      -444,      -445,      -446,      -446,      -445,      -444,      -442,
      -440,      -437,      -434,      -431,      -428,      -424,      -420,      -416,
      -412,      -407,      -403,      -398,      -393,      -388,      -384,      -379,
      -374,      -369,      -364,      -359,      -354,      -349,      -344,      -339,
      -334,      -329,      -324,      -319,      -314,      -309,      -304,      -300,
      -295,      -290,      -286,      -281,      -277,      -272,      -268,      -263
  };
  static short EOETF_300_L_slope_[64] =
  {
       -92,       -68,       -54,       -43,       -36,       -29,       -24,       -20,
       -17,       -14,       -12,        -9,        -8,        -6,        -5,        -4,
        -2,        -2,        -1,         0,         1,         1,         2,         2,
         3,         3,         3,         3,         4,         4,         4,         4,
         4,         5,         5,         5,         5,         5,         5,         5,
         5,         5,         5,         5,         5,         5,         5,         5,
         5,         5,         5,         5,         5,         5,         5,         5,
         5,         5,         5,         5,         4,         4,         4,         4
  };
  static short EOETF_300_L_bend_[64] =
  {
        16,         9,         6,         4,         3,         3,         2,         2,
         2,         1,         1,         1,         1,         1,         1,         1,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0
  };
  static short EOETF_300_H_base_[64] =
  {
      -259,      -242,      -226,      -211,      -197,      -184,      -171,      -160,
      -149,      -138,      -129,      -120,      -111,      -103,       -96,       -88,
       -82,       -76,       -70,       -64,       -59,       -54,       -49,       -44,
       -40,       -36,       -32,       -28,       -25,       -21,       -18,       -15,
       -11,        -9,        -6,        -3,         0,         2,         5,         7,
         9,        11,        13,        15,        17,        18,        20,        21,
        22,        22,        23,        23,        23,        23,        23,        22,
        21,        20,        18,        16,        14,        11,         8,         4
  };
  static short EOETF_300_H_slope_[64] =
  {
        17,        16,        15,        14,        13,        13,        12,        11,
        10,        10,         9,         9,         8,         8,         7,         7,
         6,         6,         6,         5,         5,         5,         5,         4,
         4,         4,         4,         4,         3,         3,         3,         3,
         3,         3,         3,         3,         3,         2,         2,         2,
         2,         2,         2,         2,         1,         1,         1,         1,
         1,         1,         0,         0,         0,         0,        -1,        -1,
        -1,        -2,        -2,        -2,        -3,        -3,        -4,        -4
  };
  unsigned int x;

  if (x_in <= 13107) {
    x = x_in * 5;
    return EOTFtoPQ_quadrint(EOETF_300_L_base_, EOETF_300_L_slope_, EOETF_300_L_bend_, (unsigned short)x);
  }
  else {
    x = CLIP(((x_in * 10240) - 134217728 + (1<<(SHIFT-4))) >> (SHIFT-3), 0, 65535);
    return EOTFtoPQ_quadrint(EOETF_300_H_base_, EOETF_300_H_slope_, 0, (unsigned short)x);
  }
}

/* EOTF and PQ: L_HDR = 600 nit */
unsigned int EOTFtoPQ_quadrint_600(unsigned int x_in)
{
  static short EOETF_600_L_base_[64] =
  {
         0,      -101,      -174,      -230,      -275,      -310,      -339,      -363,
      -382,      -397,      -410,      -420,      -427,      -433,      -437,      -440,
      -442,      -442,      -442,      -441,      -439,      -437,      -434,      -430,
      -427,      -422,      -418,      -413,      -408,      -403,      -398,      -393,
      -387,      -381,      -376,      -370,      -364,      -358,      -353,      -347,
      -341,      -335,      -329,      -324,      -318,      -312,      -306,      -301,
      -295,      -290,      -284,      -279,      -273,      -268,      -263,      -258,
      -252,      -247,      -242,      -237,      -233,      -228,      -223,      -218
  };
  static short EOETF_600_L_slope_[64] =
  {
      -101,       -73,       -56,       -44,       -36,       -29,       -24,       -19,
       -15,       -12,       -10,        -8,        -6,        -4,        -3,        -2,
        -1,         0,         1,         2,         2,         3,         3,         4,
         4,         4,         5,         5,         5,         5,         5,         6,
         6,         6,         6,         6,         6,         6,         6,         6,
         6,         6,         6,         6,         6,         6,         6,         6,
         6,         5,         5,         5,         5,         5,         5,         5,
         5,         5,         5,         5,         5,         5,         5,         5
  };
  static short EOETF_600_L_bend_[64] =
  {
        20,        10,         7,         5,         4,         3,         2,         2,
         2,         1,         1,         1,         1,         1,         1,         1,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0
  };
  static short EOETF_600_H_base_[64] =
  {
      -214,      -196,      -180,      -164,      -150,      -136,      -123,      -111,
      -100,       -90,       -80,       -71,       -62,       -54,       -47,       -39,
       -33,       -26,       -20,       -14,        -8,        -3,         2,         7,
        12,        17,        21,        25,        29,        33,        37,        41,
        45,        48,        51,        55,        58,        60,        63,        65,
        68,        70,        71,        73,        74,        75,        75,        75,
        75,        75,        74,        72,        70,        68,        65,        61,
        57,        52,        47,        41,        34,        27,        19,        10
  };
  static short EOETF_600_H_slope_[64] =
  {
        18,        17,        16,        15,        14,        13,        12,        11,
        10,        10,         9,         9,         8,         8,         7,         7,
         6,         6,         6,         6,         5,         5,         5,         5,
         5,         4,         4,         4,         4,         4,         4,         4,
         3,         3,         3,         3,         3,         3,         2,         2,
         2,         2,         1,         1,         1,         1,         0,         0,
        -1,        -1,        -1,        -2,        -2,        -3,        -4,        -4,
        -5,        -5,        -6,        -7,        -7,        -8,        -9,       -10
  };
  static short EOETF_600_H_bend_[64] =
  {
        -1,        -1,        -1,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0
  };
  unsigned int x;

  if (x_in <= 13107) {
    x = x_in * 5;
    return EOTFtoPQ_quadrint(EOETF_600_L_base_, EOETF_600_L_slope_, EOETF_600_L_bend_, (unsigned short)x);
  }
  else {
    x = CLIP(((x_in * 10240) - 134217728 + (1<<(SHIFT-4))) >> (SHIFT-3), 0, 65535);
    return EOTFtoPQ_quadrint(EOETF_600_H_base_, EOETF_600_H_slope_, EOETF_600_H_bend_, (unsigned short)x);
  }
}

/* EOTF and PQ: L_HDR = 1000 nit */
unsigned int EOTFtoPQ_quadrint_1000(unsigned int x_in)
{
  static short EOETF_1000_L_base_[64] =
  {
         0,      -108,      -184,      -241,      -286,      -322,      -350,      -372,
      -390,      -404,      -415,      -424,      -430,      -434,      -437,      -438,
      -438,      -437,      -435,      -433,      -429,      -426,      -421,      -417,
      -412,      -406,      -401,      -395,      -389,      -383,      -376,      -370,
      -364,      -357,      -351,      -344,      -337,      -331,      -324,      -318,
      -311,      -305,      -298,      -292,      -286,      -279,      -273,      -267,
      -261,      -255,      -249,      -243,      -237,      -231,      -226,      -220,
      -215,      -209,      -204,      -199,      -194,      -188,      -183,      -179
  };
  static short EOETF_1000_L_slope_[64] =
  {
      -108,       -76,       -58,       -45,       -36,       -28,       -23,       -18,
       -14,       -11,        -8,        -6,        -4,        -3,        -1,         0,
         1,         2,         3,         3,         4,         4,         5,         5,
         5,         6,         6,         6,         6,         6,         6,         6,
         7,         7,         7,         7,         7,         7,         7,         7,
         6,         6,         6,         6,         6,         6,         6,         6,
         6,         6,         6,         6,         6,         6,         6,         5,
         5,         5,         5,         5,         5,         5,         5,         5
  };
  static short EOETF_1000_L_bend_[64] =
  {
        22,        11,         7,         5,         4,         3,         3,         2,
         2,         1,         1,         1,         1,         1,         1,         1,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0
  };
  static short EOETF_1000_H_base_[64] =
  {
      -174,      -155,      -138,      -121,      -106,       -92,       -79,       -66,
       -54,       -43,       -33,       -23,       -14,        -5,         3,        11,
        18,        26,        33,        39,        46,        52,        58,        64,
        70,        75,        81,        86,        91,        96,       100,       105,
       109,       113,       117,       121,       124,       127,       130,       133,
       135,       137,       138,       139,       140,       140,       139,       138,
       136,       134,       131,       127,       123,       118,       112,       105,
        98,        89,        80,        69,        57,        45,        31,        16
  };
  static short EOETF_1000_H_slope_[64] =
  {
        19,        17,        16,        15,        14,        13,        12,        12,
        11,        10,        10,         9,         9,         8,         8,         8,
         7,         7,         7,         6,         6,         6,         6,         6,
         6,         5,         5,         5,         5,         5,         5,         4,
         4,         4,         4,         3,         3,         3,         3,         2,
         2,         1,         1,         0,         0,        -1,        -1,        -2,
        -2,        -3,        -4,        -4,        -5,        -6,        -7,        -8,
        -9,       -10,       -11,       -12,       -13,       -14,       -15,       -16
  };
  static short EOETF_1000_H_bend_[64] =
  {
        -1,        -1,        -1,        -1,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,        -1,        -1,        -1,        -1,        -1,        -1
  };
  unsigned int x;

  if (x_in <= 13107) {
    x = x_in * 5;
    return EOTFtoPQ_quadrint(EOETF_1000_L_base_, EOETF_1000_L_slope_, EOETF_1000_L_bend_, (unsigned short)x);
  }
  else {
    x = CLIP(((x_in * 10240) - 134217728 + (1<<(SHIFT-4))) >> (SHIFT-3), 0, 65535);
    return EOTFtoPQ_quadrint(EOETF_1000_H_base_, EOETF_1000_H_slope_, EOETF_1000_H_bend_, (unsigned short)x);
  }
}

/* EOTF and PQ: L_HDR = 3000 nit */
unsigned int EOTFtoPQ_quadrint_3000(unsigned int x_in)
{
  static short EOETF_3000_L_base_[64] =
  {
         0,      -121,      -202,      -262,      -306,      -340,      -366,      -385,
      -400,      -410,      -417,      -421,      -424,      -424,      -422,      -420,
      -416,      -411,      -406,      -400,      -393,      -386,      -379,      -371,
      -363,      -355,      -346,      -338,      -329,      -320,      -311,      -303,
      -294,      -285,      -276,      -268,      -259,      -251,      -242,      -234,
      -225,      -217,      -209,      -201,      -193,      -185,      -178,      -170,
      -163,      -155,      -148,      -141,      -134,      -127,      -120,      -113,
      -106,      -100,       -94,       -87,       -81,       -75,       -69,       -63
  };
  static short EOETF_3000_L_slope_[64] =
  {
      -121,       -81,       -59,       -45,       -34,       -26,       -19,       -14,
       -10,        -7,        -4,        -2,         0,         1,         3,         4,
         5,         5,         6,         7,         7,         7,         8,         8,
         8,         8,         9,         9,         9,         9,         9,         9,
         9,         9,         9,         9,         9,         8,         8,         8,
         8,         8,         8,         8,         8,         8,         8,         7,
         7,         7,         7,         7,         7,         7,         7,         7,
         7,         6,         6,         6,         6,         6,         6,         6
  };
  static short EOETF_3000_L_bend_[64] =
  {
        28,        14,         9,         6,         5,         4,         3,         2,
         2,         1,         1,         1,         1,         1,         1,         1,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0
  };
  static short EOETF_3000_H_base_[64] =
  {
       -57,       -35,       -14,         6,        25,        43,        59,        75,
        90,       105,       119,       132,       145,       158,       170,       182,
       193,       205,       216,       227,       237,       248,       258,       268,
       278,       287,       296,       305,       314,       322,       330,       337,
       344,       350,       356,       361,       366,       370,       373,       376,
       377,       378,       377,       376,       374,       370,       365,       359,
       352,       343,       333,       321,       308,       293,       276,       257,
       237,       215,       190,       164,       136,       105,        72,        37
  };
  static short EOETF_3000_H_slope_[64] =
  {
        22,        21,        20,        19,        18,        17,        16,        15,
        15,        14,        13,        13,        13,        12,        12,        12,
        11,        11,        11,        11,        10,        10,        10,        10,
         9,         9,         9,         9,         8,         8,         7,         7,
         6,         6,         5,         5,         4,         3,         2,         2,
         1,         0,        -1,        -2,        -4,        -5,        -6,        -7,
        -9,       -10,       -12,       -13,       -15,       -17,       -19,       -20,
       -22,       -24,       -26,       -28,       -31,       -33,       -35,       -37
  };
  static short EOETF_3000_H_bend_[64] =
  {
        -1,        -1,        -1,        -1,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,        -1,        -1,        -1,        -1,        -1,        -1,
        -1,        -1,        -1,        -1,        -1,        -1,        -1,        -1,
        -1,        -1,        -1,        -1,        -1,        -1,        -1,        -1
  };
  unsigned int x;

  if (x_in <= 13107) {
    x = x_in * 5;
    return EOTFtoPQ_quadrint(EOETF_3000_L_base_, EOETF_3000_L_slope_, EOETF_3000_L_bend_, (unsigned short)x);
  }
  else {
    x = CLIP(((x_in * 10240) - 134217728 + (1<<(SHIFT-4))) >> (SHIFT-3), 0, 65535);
    return EOTFtoPQ_quadrint(EOETF_3000_H_base_, EOETF_3000_H_slope_, EOETF_3000_H_bend_, (unsigned short)x);
  }
}

/* EOTF and PQ: L_HDR = 6000 nit */
unsigned int EOTFtoPQ_quadrint_6000 (unsigned int x_in)
{
  static short EOETF_6000_L_base_[64] =
  {
        0,      -128,      -212,      -272,      -315,      -347,      -371,      -387,
      -399,      -406,      -410,      -411,      -411,      -408,      -403,      -398,
      -391,      -384,      -376,      -367,      -358,      -348,      -338,      -328,
      -318,      -308,      -297,      -286,      -276,      -265,      -254,      -244,
      -233,      -223,      -212,      -202,      -192,      -181,      -171,      -162,
      -152,      -142,      -133,      -123,      -114,      -105,       -96,       -87,
       -78,       -69,       -61,       -52,       -44,       -36,       -28,       -20,
       -12,        -5,         3,        10,        18,        25,        32,        39
  };
  static short EOETF_6000_L_slope_[64] =
  {
     -128,       -84,       -60,       -43,       -32,       -23,       -17,       -12,
        -7,        -4,        -1,         1,         3,         4,         6,         7,
         7,         8,         9,         9,        10,        10,        10,        10,
        10,        11,        11,        11,        11,        11,        11,        11,
        11,        10,        10,        10,        10,        10,        10,        10,
        10,        10,         9,         9,         9,         9,         9,         9,
         9,         9,         8,         8,         8,         8,         8,         8,
         8,         8,         7,         7,         7,         7,         7,         7
  };
  static short EOETF_6000_L_bend_[64] =
  {
        32,        15,        10,         7,         5,         4,         3,         2,
         2,         1,         1,         1,         1,         1,         1,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0
  };
  static short EOETF_6000_H_base_[64] =
  {
        46,        72,        98,       122,       145,       166,       187,       208,
       227,       246,       264,       282,       300,       317,       334,       351,
       367,       383,       399,       414,       429,       444,       459,       473,
       487,       500,       513,       526,       538,       549,       560,       570,
       579,       587,       595,       601,       607,       611,       614,       616,
       616,       615,       612,       608,       602,       594,       585,       573,
       560,       544,       526,       506,       484,       459,       431,       401,
       369,       333,       295,       253,       209,       162,       111,        57
  };
  static short EOETF_6000_H_slope_[64] =
  {
        27,        25,        24,        23,        22,        21,        20,        20,
        19,        18,        18,        18,        17,        17,        17,        16,
        16,        16,        15,        15,        15,        15,        14,        14,
        13,        13,        13,        12,        11,        11,        10,         9,
         8,         7,         6,         5,         4,         3,         2,         0,
        -1,        -3,        -4,        -6,        -8,       -10,       -11,       -14,
       -16,       -18,       -20,       -22,       -25,       -27,       -30,       -33,
       -36,       -38,       -41,       -44,       -47,       -51,       -54,       -57
  };
  static short EOETF_6000_H_bend_[64] =
  {
        -1,        -1,        -1,        -1,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,        -1,        -1,        -1,        -1,        -1,        -1,
        -1,        -1,        -1,        -1,        -1,        -1,        -1,        -1,
        -1,        -1,        -1,        -1,        -1,        -1,        -1,        -1,
        -1,        -1,        -1,        -2,        -2,        -2,        -2,        -2
  };
  unsigned int x;

  if (x_in <= 13107) {
    x = x_in * 5;
    return EOTFtoPQ_quadrint(EOETF_6000_L_base_, EOETF_6000_L_slope_, EOETF_6000_L_bend_, (unsigned short)x);
  }
  else {
    x = CLIP(((x_in * 10240) - 134217728 + (1<<(SHIFT-4))) >> (SHIFT-3), 0, 65535);
    return EOTFtoPQ_quadrint(EOETF_6000_H_base_, EOETF_6000_H_slope_, EOETF_6000_H_bend_, (unsigned short)x);
  }
}

/* EOTF and PQ: L_HDR = 10000 nit */
unsigned int EOTFtoPQ_quadrint_10000(unsigned int x_in)
{
  static short EOETF_10000_L_base_[64] =
  {
         0,      -133,      -219,      -278,      -320,      -350,      -371,      -385,
      -394,      -399,      -401,      -399,      -396,      -391,      -384,      -376,
      -367,      -357,      -347,      -336,      -325,      -313,      -301,      -289,
      -277,      -265,      -252,      -240,      -227,      -215,      -203,      -191,
      -178,      -166,      -154,      -143,      -131,      -119,      -108,       -97,
       -86,       -75,       -64,       -53,       -42,       -32,       -22,       -12,
        -2,         8,        18,        27,        37,        46,        55,        64,
        73,        82,        90,        99,       107,       116,       124,       132
  };
  static short EOETF_10000_L_slope_[64] =
  {
      -134,       -85,       -59,       -42,       -30,       -21,       -14,        -9,
        -5,        -1,         1,         3,         5,         7,         8,         9,
        10,        10,        11,        11,        12,        12,        12,        12,
        12,        12,        12,        12,        12,        12,        12,        12,
        12,        12,        12,        12,        12,        11,        11,        11,
        11,        11,        11,        11,        10,        10,        10,        10,
        10,        10,        10,         9,         9,         9,         9,         9,
         9,         9,         9,         8,         8,         8,         8,         8
  };
  static short EOETF_10000_L_bend_[64] =
  {
        35,        16,        10,         7,         5,         4,         3,         2,
         2,         2,         1,         1,         1,         1,         1,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0
  };
  static short EOETF_10000_H_base_[64] =
  {
       140,       171,       201,       229,       256,       283,       308,       333,
       357,       380,       403,       426,       448,       470,       492,       513,
       534,       554,       575,       595,       615,       634,       653,       671,
       689,       706,       723,       738,       753,       768,       781,       793,
       804,       814,       823,       830,       836,       840,       842,       843,
       842,       839,       834,       826,       817,       805,       791,       774,
       754,       732,       707,       679,       647,       613,       575,       534,
       490,       442,       390,       335,       276,       213,       146,        75
  };
  static short EOETF_10000_H_slope_[64] =
  {
        31,        30,        28,        27,        26,        25,        25,        24,
        24,        23,        23,        22,        22,        22,        21,        21,
        21,        20,        20,        20,        19,        19,        18,        18,
        17,        17,        16,        15,        14,        13,        12,        11,
        10,         9,         7,         6,         4,         3,         1,        -1,
        -3,        -5,        -7,       -10,       -12,       -14,       -17,       -20,
       -22,       -25,       -28,       -31,       -34,       -38,       -41,       -44,
       -48,       -52,       -55,       -59,       -63,       -67,       -71,       -75
  };
  static short EOETF_10000_H_bend_[64] =
  {
        -1,        -1,        -1,        -1,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,         0,         0,
         0,         0,         0,         0,         0,         0,        -1,        -1,
        -1,        -1,        -1,        -1,        -1,        -1,        -1,        -1,
        -1,        -1,        -1,        -1,        -1,        -1,        -1,        -1,
        -1,        -1,        -2,        -2,        -2,        -2,        -2,        -2,
        -2,        -2,        -2,        -2,        -2,        -2,        -2,        -2
  };
  unsigned int x;

  if (x_in <= 13107) {
    x = x_in * 5;
    return EOTFtoPQ_quadrint(EOETF_10000_L_base_, EOETF_10000_L_slope_, EOETF_10000_L_bend_, (unsigned short)x);
  }
  else {
    x = CLIP(((x_in * 10240) - 134217728 + (1<<(SHIFT-4))) >> (SHIFT-3), 0, 65535);
    return EOTFtoPQ_quadrint(EOETF_10000_H_base_, EOETF_10000_H_slope_, EOETF_10000_H_bend_, (unsigned short)x);
  }
}
